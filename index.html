<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Progress</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 0;
        }

        .road {
            position: relative;
            width: 80%;
            height: 20px;
            background-color: #969696;
            margin: 50px 0;
            border-radius: 5px;
        }

        .road-marks {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            width: 100%;
            height: 10%;
            background-image: repeating-linear-gradient(to right, rgb(215, 215, 27) 0 20px, transparent 20px 40px);
            pointer-events: none;
        }

        .car {
            position: absolute;
            top: -50px;
            left: 0;
            width: 160px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            transform: scaleX(-1);
            /* background-image, background-size removed */
        }

        .destination {
            position: absolute;
            top: -60px;
            right: 0;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
        }

        .controls {
            margin-top: 20px;
        }

        .controls input {
            width: 300px;
            padding: 5px;
            margin-right: 10px;
        }

        .controls button {
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <h1 id="timeRemaining">Trip progress</h1>
        <div class="road">
            <div class="road-marks"></div>
            <div class="car">üöó</div>
            <div class="destination">üè´</div>
        </div>
    <div class="controls">
        <button onclick="addMinutes(5)">+5 min</button>
        <button onclick="resetTrip()">Reset</button>
    </div>

    <script>
        const car = document.querySelector('.car');
        const road = document.querySelector('.road');
        const timeRemainingEl = document.getElementById('timeRemaining');
        let progress = 0;
        let intervalId = null;
        let totalSeconds = 0;
        let elapsedSeconds = 0;

        function startTrip(minutes) {
            if (!minutes || minutes <= 0) {
                alert('Please enter a valid duration in minutes (minimum 1).');
                return;
            }

            // Reset state
            clearInterval(intervalId);
            progress = 0;
            elapsedSeconds = 0;
            totalSeconds = Math.round(minutes * 60);
            updateTimeRemaining();
            updateCarPosition();

            intervalId = setInterval(() => {
                elapsedSeconds += 1;
                progress = Math.min(100, (elapsedSeconds / totalSeconds) * 100);
                updateCarPosition();
                updateTimeRemaining();

                if (elapsedSeconds >= totalSeconds) {
                    clearInterval(intervalId);
                    intervalId = null;
                }
            }, 1000);
        }

        function addMinutes(minutes) {
            if (minutes <= 0) return;
            if (intervalId === null) {
                // No trip running, start a new trip
                startTrip(minutes);
            } else {
                // Add minutes to totalSeconds
                totalSeconds += minutes * 60;
                updateTimeRemaining();
            }
        }

        function resetTrip() {
            clearInterval(intervalId);
            intervalId = null;
            progress = 0;
            elapsedSeconds = 0;
            totalSeconds = 0;
            car.style.left = '0px'; // Explicitly move car to the beginning
            updateCarPosition();
            updateTimeRemaining();
        }

        function updateCarPosition() {
            const roadWidth = road.offsetWidth - car.offsetWidth; // keep car inside road
            const carPosition = (progress / 100) * roadWidth;
            car.style.left = `${carPosition}px`;
        }

        function updateTimeRemaining() {
            if (!totalSeconds) {
                timeRemainingEl.textContent = 'Trip progress';
                return;
            }
            const remaining = Math.max(0, totalSeconds - elapsedSeconds);
            const mins = Math.floor(remaining / 60);
            const secs = remaining % 60;
            timeRemainingEl.textContent = `Time left: ${mins}m ${secs}s`;
        }

        // Keep car positioned correctly if the window is resized
        window.addEventListener('resize', updateCarPosition);

        // Ensure car starts at 0
        car.style.left = '0px';
    </script>
</body>
</html>